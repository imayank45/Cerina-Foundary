{"ast":null,"code":"var _s = $RefreshSig$();\n// import { useState } from \"react\";\n// import axios from \"axios\";\n// import { ProtocolState, ProtocolResponse, ApprovalResponse } from \"../types\";\n\n// const API_BASE = process.env.REACT_APP_API_URL || \"http://localhost:8000\";\n\n// export function useProtocolGenerator() {\n//   const [state, setState] = useState<ProtocolState | null>(null);\n//   const [loading, setLoading] = useState(false);\n//   const [error, setError] = useState(\"\");\n\n//   const generate = async (userIntent: string, originalQuery: string) => {\n//     setLoading(true);\n//     setError(\"\");\n//     try {\n//       const response = await axios.post(`${API_BASE}/generate`, {\n//         user_intent: userIntent,\n//         original_query: originalQuery,\n//       });\n\n//       const data = response.data as ProtocolResponse;\n//       setState({\n//         thread_id: data.thread_id,\n//         status: data.status,\n//         current_draft: data.current_draft,\n//         safety_flags: data.safety_flags,\n//         clinical_feedback: data.clinical_feedback,\n//         empathy_score: data.empathy_score,\n//         safety_score: data.safety_score,\n//         agent_notes: data.agent_notes,\n//         iteration_count: data.iteration_count,\n//       });\n//     } catch (err: any) {\n//       const errorMsg = err.response?.data?.detail || \"Generation failed\";\n//       setError(errorMsg);\n//     } finally {\n//       setLoading(false);\n//     }\n//   };\n\n//   const approve = async (threadId: string, edits: string = \"\") => {\n//     setLoading(true);\n//     try {\n//       const response = await axios.post(`${API_BASE}/approve`, {\n//         thread_id: threadId,\n//         human_approval: true,\n//         human_edits: edits,\n//       });\n\n//       const data = response.data as ApprovalResponse;\n//       setState((prev) => \n//         prev ? {\n//           ...prev,\n//           status: data.status,\n//           current_draft: data.final_protocol,\n//         } : null\n//       );\n//     } catch (err: any) {\n//       const errorMsg = err.response?.data?.detail || \"Approval failed\";\n//       setError(errorMsg);\n//     } finally {\n//       setLoading(false);\n//     }\n//   };\n\n//   return { state, loading, error, generate, approve };\n// }\n\nimport { useState } from \"react\";\nimport axios from \"axios\";\nconst API_BASE = process.env.REACT_APP_API_URL || \"http://localhost:8000\";\nexport function useProtocolGenerator() {\n  _s();\n  const [state, setState] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n  const generate = async (userIntent, originalQuery) => {\n    setLoading(true);\n    setError(\"\");\n    try {\n      var _data$current_draft, _data$safety_flags, _data$clinical_feedba, _data$empathy_score, _data$safety_score, _data$agent_notes, _data$iteration_count;\n      const response = await axios.post(`${API_BASE}/generate`, {\n        user_intent: userIntent,\n        original_query: originalQuery\n      });\n      const data = response.data;\n      console.log(\"GENERATE response:\", data);\n\n      // Safely map all fields expected by ProtocolState\n      const validStatuses = [\"drafting\", \"safety_review\", \"clinical_review\", \"halted\", \"finalized\"];\n      const nextState = {\n        thread_id: data.thread_id,\n        status: validStatuses.includes(data.status) ? data.status : \"drafting\",\n        current_draft: (_data$current_draft = data.current_draft) !== null && _data$current_draft !== void 0 ? _data$current_draft : \"\",\n        safety_flags: (_data$safety_flags = data.safety_flags) !== null && _data$safety_flags !== void 0 ? _data$safety_flags : [],\n        clinical_feedback: (_data$clinical_feedba = data.clinical_feedback) !== null && _data$clinical_feedba !== void 0 ? _data$clinical_feedba : \"\",\n        empathy_score: (_data$empathy_score = data.empathy_score) !== null && _data$empathy_score !== void 0 ? _data$empathy_score : 0,\n        safety_score: (_data$safety_score = data.safety_score) !== null && _data$safety_score !== void 0 ? _data$safety_score : 0,\n        agent_notes: (_data$agent_notes = data.agent_notes) !== null && _data$agent_notes !== void 0 ? _data$agent_notes : {},\n        iteration_count: (_data$iteration_count = data.iteration_count) !== null && _data$iteration_count !== void 0 ? _data$iteration_count : 0\n      };\n      setState(nextState);\n    } catch (err) {\n      var _err$response, _err$response$data;\n      console.error(\"GENERATE error:\", err);\n      const errorMsg = ((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.detail) || \"Generation failed\";\n      setError(errorMsg);\n    } finally {\n      setLoading(false);\n    }\n  };\n  const approve = async (threadId, edits = \"\") => {\n    setLoading(true);\n    setError(\"\");\n    try {\n      const response = await axios.post(`${API_BASE}/approve`, {\n        thread_id: threadId,\n        human_approval: true,\n        human_edits: edits\n      });\n      const data = response.data;\n      console.log(\"APPROVE response:\", data);\n      const validStatuses = [\"drafting\", \"safety_review\", \"clinical_review\", \"halted\", \"finalized\"];\n      setState(prev => {\n        var _data$final_protocol;\n        return prev ? {\n          ...prev,\n          status: validStatuses.includes(data.status) ? data.status : prev.status,\n          current_draft: (_data$final_protocol = data.final_protocol) !== null && _data$final_protocol !== void 0 ? _data$final_protocol : prev.current_draft\n        } : null;\n      });\n    } catch (err) {\n      var _err$response2, _err$response2$data;\n      console.error(\"APPROVE error:\", err);\n      const errorMsg = ((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : _err$response2$data.detail) || \"Approval failed\";\n      setError(errorMsg);\n    } finally {\n      setLoading(false);\n    }\n  };\n  return {\n    state,\n    loading,\n    error,\n    generate,\n    approve\n  };\n}\n_s(useProtocolGenerator, \"yaXUEZPeh5Vn/zyIIW6Q8K7tK60=\");","map":{"version":3,"names":["useState","axios","API_BASE","process","env","REACT_APP_API_URL","useProtocolGenerator","_s","state","setState","loading","setLoading","error","setError","generate","userIntent","originalQuery","_data$current_draft","_data$safety_flags","_data$clinical_feedba","_data$empathy_score","_data$safety_score","_data$agent_notes","_data$iteration_count","response","post","user_intent","original_query","data","console","log","validStatuses","nextState","thread_id","status","includes","current_draft","safety_flags","clinical_feedback","empathy_score","safety_score","agent_notes","iteration_count","err","_err$response","_err$response$data","errorMsg","detail","approve","threadId","edits","human_approval","human_edits","prev","_data$final_protocol","final_protocol","_err$response2","_err$response2$data"],"sources":["/Users/mayankkathane/Projects/Cerina Foundary/frontend/src/hooks/useProtocolGenerator.ts"],"sourcesContent":["// import { useState } from \"react\";\n// import axios from \"axios\";\n// import { ProtocolState, ProtocolResponse, ApprovalResponse } from \"../types\";\n\n// const API_BASE = process.env.REACT_APP_API_URL || \"http://localhost:8000\";\n\n// export function useProtocolGenerator() {\n//   const [state, setState] = useState<ProtocolState | null>(null);\n//   const [loading, setLoading] = useState(false);\n//   const [error, setError] = useState(\"\");\n\n//   const generate = async (userIntent: string, originalQuery: string) => {\n//     setLoading(true);\n//     setError(\"\");\n//     try {\n//       const response = await axios.post(`${API_BASE}/generate`, {\n//         user_intent: userIntent,\n//         original_query: originalQuery,\n//       });\n      \n//       const data = response.data as ProtocolResponse;\n//       setState({\n//         thread_id: data.thread_id,\n//         status: data.status,\n//         current_draft: data.current_draft,\n//         safety_flags: data.safety_flags,\n//         clinical_feedback: data.clinical_feedback,\n//         empathy_score: data.empathy_score,\n//         safety_score: data.safety_score,\n//         agent_notes: data.agent_notes,\n//         iteration_count: data.iteration_count,\n//       });\n//     } catch (err: any) {\n//       const errorMsg = err.response?.data?.detail || \"Generation failed\";\n//       setError(errorMsg);\n//     } finally {\n//       setLoading(false);\n//     }\n//   };\n\n//   const approve = async (threadId: string, edits: string = \"\") => {\n//     setLoading(true);\n//     try {\n//       const response = await axios.post(`${API_BASE}/approve`, {\n//         thread_id: threadId,\n//         human_approval: true,\n//         human_edits: edits,\n//       });\n\n//       const data = response.data as ApprovalResponse;\n//       setState((prev) => \n//         prev ? {\n//           ...prev,\n//           status: data.status,\n//           current_draft: data.final_protocol,\n//         } : null\n//       );\n//     } catch (err: any) {\n//       const errorMsg = err.response?.data?.detail || \"Approval failed\";\n//       setError(errorMsg);\n//     } finally {\n//       setLoading(false);\n//     }\n//   };\n\n//   return { state, loading, error, generate, approve };\n// }\n\n\n\nimport { useState } from \"react\";\nimport axios from \"axios\";\nimport { ProtocolState, ProtocolResponse, ApprovalResponse } from \"../types\";\n\nconst API_BASE = process.env.REACT_APP_API_URL || \"http://localhost:8000\";\n\nexport function useProtocolGenerator() {\n  const [state, setState] = useState<ProtocolState | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n\n  const generate = async (userIntent: string, originalQuery: string) => {\n    setLoading(true);\n    setError(\"\");\n    try {\n      const response = await axios.post<ProtocolResponse>(`${API_BASE}/generate`, {\n        user_intent: userIntent,\n        original_query: originalQuery,\n      });\n\n      const data = response.data;\n      console.log(\"GENERATE response:\", data);\n\n      // Safely map all fields expected by ProtocolState\n      const validStatuses = [\"drafting\", \"safety_review\", \"clinical_review\", \"halted\", \"finalized\"];\n      const nextState: ProtocolState = {\n        thread_id: data.thread_id,\n        status: (validStatuses.includes(data.status) ? data.status : \"drafting\") as \"drafting\" | \"safety_review\" | \"clinical_review\" | \"halted\" | \"finalized\",\n        current_draft: data.current_draft ?? \"\",\n        safety_flags: data.safety_flags ?? [],\n        clinical_feedback: data.clinical_feedback ?? \"\",\n        empathy_score: data.empathy_score ?? 0,\n        safety_score: data.safety_score ?? 0,\n        agent_notes: data.agent_notes ?? {},\n        iteration_count: data.iteration_count ?? 0,\n      };\n\n      setState(nextState);\n    } catch (err: any) {\n      console.error(\"GENERATE error:\", err);\n      const errorMsg = err.response?.data?.detail || \"Generation failed\";\n      setError(errorMsg);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const approve = async (threadId: string, edits: string = \"\") => {\n    setLoading(true);\n    setError(\"\");\n    try {\n      const response = await axios.post<ApprovalResponse>(`${API_BASE}/approve`, {\n        thread_id: threadId,\n        human_approval: true,\n        human_edits: edits,\n      });\n\n      const data = response.data;\n      console.log(\"APPROVE response:\", data);\n\n      const validStatuses = [\"drafting\", \"safety_review\", \"clinical_review\", \"halted\", \"finalized\"];\n      setState((prev) =>\n        prev\n          ? {\n              ...prev,\n              status: (validStatuses.includes(data.status) ? data.status : prev.status) as \"drafting\" | \"safety_review\" | \"clinical_review\" | \"halted\" | \"finalized\",\n              current_draft: data.final_protocol ?? prev.current_draft,\n            }\n          : null\n      );\n    } catch (err: any) {\n      console.error(\"APPROVE error:\", err);\n      const errorMsg = err.response?.data?.detail || \"Approval failed\";\n      setError(errorMsg);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return { state, loading, error, generate, approve };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}